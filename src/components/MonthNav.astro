---
import type { CollectionEntry } from 'astro:content';

interface Props {
  races: CollectionEntry<"races">[];
}

const { races } = Astro.props;

// Get current date
const now = new Date();
now.setHours(0, 0, 0, 0);

// Generate next 12 months
const months = Array.from({ length: 12 }, (_, i) => {
  const date = new Date(now.getFullYear(), now.getMonth() + i, 1);
  return {
    key: `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`,
    date: date
  };
});

// Find months with races
const monthsWithRaces = new Set(races.map(race => {
  const date = new Date(race.data.date);
  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
}));
---

<nav>
  <div class="flex flex-wrap gap-2 py-4">
    {months.map(({ key, date }) => {
      const month = date.toLocaleDateString('en-NZ', { month: 'long' });
      const year = date.getFullYear();
      const isCurrent = date.getMonth() === now.getMonth() && 
                       date.getFullYear() === now.getFullYear();
      const hasRaces = monthsWithRaces.has(key);
      
      const Element = hasRaces ? 'a' : 'div';
      const props = hasRaces ? { href: `#${key}` } : {};
      
      return (
        <Element
          {...props}
          class:list={[
            'group relative flex items-center justify-center px-4 py-2 w-[140px]',
            'text-sm font-medium rounded-md transition-all duration-200',
            'backdrop-blur-sm shadow-lg ring-1 ring-inset',
            {
              'bg-[#4A7153] text-white hover:bg-[#5C8A66] ring-[#2C432F]/50 hover:shadow-xl': isCurrent && hasRaces,
              'bg-[#4A7153] text-white ring-[#2C432F]/50': isCurrent && !hasRaces,
              'bg-neutral-900/70 text-neutral-300 hover:bg-neutral-800/80 hover:text-white hover:shadow-xl ring-neutral-700/50': !isCurrent && hasRaces,
              'bg-neutral-900/70 text-neutral-400 ring-neutral-700/50 cursor-default': !isCurrent && !hasRaces
            }
          ]}
        >
          <span class="flex flex-col items-center">
            <span class="font-semibold">{month}</span>
            <span class="text-xs opacity-80">{year}</span>
          </span>
        </Element>
      );
    })}
  </div>
</nav> 